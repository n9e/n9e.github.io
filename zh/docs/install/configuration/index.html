<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=preload as=font href=https://n9e.github.io/fonts/vendor/jost/jost-v4-latin-regular.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=https://n9e.github.io/fonts/vendor/jost/jost-v4-latin-500.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=https://n9e.github.io/fonts/vendor/jost/jost-v4-latin-700.woff2 type=font/woff2 crossorigin><script>(()=>{var t=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,e=localStorage.getItem("theme");t&&e===null&&(localStorage.setItem("theme","dark"),document.documentElement.setAttribute("data-dark-mode","")),t&&e==="dark"&&document.documentElement.setAttribute("data-dark-mode",""),e==="dark"&&document.documentElement.setAttribute("data-dark-mode","")})()</script><link rel=stylesheet href=https://n9e.github.io/main.339b89be9e03bb86f7664e9dbcd4ffacb1fd8412a0639b87e1badf74892a2e0cda5b6186cf69e5a2c70d6cf1aa434440a42e1baa1027966ac9f61466866b27ed.css integrity="sha512-M5uJvp4Du4b3Zk6dvNT/rLH9hBKgY5uH4brfdIkqLgzaW2GGz2nloscNbPGqQ0RApC4bqhAnlmrJ9hRmhmsn7Q==" crossorigin=anonymous><noscript><style>img.lazyload{display:none}</style></noscript><meta name=robots content="index, follow"><meta name=googlebot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><meta name=bingbot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><title>配置讲解 - Nightingale</title><meta name=description content="讲解夜莺监控的配置文件，对各个配置项的作用做详细讲解"><link rel=canonical href=https://n9e.github.io/zh/docs/install/configuration/><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="og:title" content="配置讲解"><meta property="og:description" content="讲解夜莺监控的配置文件，对各个配置项的作用做详细讲解"><meta property="og:url" content="https://n9e.github.io/zh/docs/install/configuration/"><meta property="og:site_name" content="Home"><meta property="article:published_time" content="2025-02-27T11:00:00+08:00"><meta property="article:modified_time" content="2025-02-27T12:20:56+08:00"><meta property="og:image" content="https://n9e.github.io/doks.png"><meta property="og:image:alt" content="Home"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@ulricqin"><meta name=twitter:creator content="@henkverlinde"><meta name=twitter:title content="配置讲解"><meta name=twitter:description content="讲解夜莺监控的配置文件，对各个配置项的作用做详细讲解"><meta name=twitter:image content="https://n9e.github.io/doks.png"><meta name=twitter:image:alt content="配置讲解"><script type=application/ld+json>{"@context":"https://schema.org","@graph":[{"@type":"Organization","@id":"https://n9e.github.io/#/schema/organization/1","name":"Doks","url":"https://n9e.github.io/","sameAs":["https://twitter.com/ulricqin","https://github.com/ccfos/nightingale"],"logo":{"@type":"ImageObject","@id":"https://n9e.github.io/#/schema/image/1","url":"https://n9e.github.io/logo-doks.png","width":512,"height":512,"caption":"Doks"},"image":{"@id":"https://n9e.github.io/#/schema/image/1"}},{"@type":"WebSite","@id":"https://n9e.github.io/#/schema/website/1","url":"https://n9e.github.io/","name":"Home","description":"Nightingale is an open-source monitoring system that focuses on alerting.","publisher":{"@id":"https://n9e.github.io/#/schema/organization/1"}},{"@type":"WebPage","@id":"https://n9e.github.io/zh/docs/install/configuration/","url":"https://n9e.github.io/zh/docs/install/configuration/","name":"配置讲解","description":"讲解夜莺监控的配置文件，对各个配置项的作用做详细讲解","isPartOf":{"@id":"https://n9e.github.io/#/schema/website/1"},"about":{"@id":"https://n9e.github.io/#/schema/organization/1"},"datePublished":"2025-02-27T11:00:00CET","dateModified":"2025-02-27T12:20:56CET","breadcrumb":{"@id":"https://n9e.github.io/zh/docs/install/configuration/#/schema/breadcrumb/1"},"primaryImageOfPage":{"@id":"https://n9e.github.io/zh/docs/install/configuration/#/schema/image/2"},"inLanguage":"en-US","potentialAction":[{"@type":"ReadAction","target":["https://n9e.github.io/zh/docs/install/configuration/"]}]},{"@type":"BreadcrumbList","@id":"https://n9e.github.io/zh/docs/install/configuration/#/schema/breadcrumb/1","name":"Breadcrumbs","itemListElement":[{"@type":"ListItem","position":1,"item":{"@type":"WebPage","@id":"https://n9e.github.io/","url":"https://n9e.github.io/","name":"Home"}},{"@type":"ListItem","position":2,"item":{"@type":"WebPage","@id":"https://n9e.github.io/zh/","url":"https://n9e.github.io/zh/","name":"Zh"}},{"@type":"ListItem","position":3,"item":{"@type":"WebPage","@id":"https://n9e.github.io/zh/docs/","url":"https://n9e.github.io/zh/docs/","name":"Docs"}},{"@type":"ListItem","position":4,"item":{"@type":"WebPage","@id":"https://n9e.github.io/zh/docs/install/","url":"https://n9e.github.io/zh/docs/install/","name":"Install"}},{"@type":"ListItem","position":5,"item":{"@id":"https://n9e.github.io/zh/docs/install/configuration/"}}]},{"@context":"https://schema.org","@graph":[{"@type":"Article","@id":"https://n9e.github.io/#/schema/article/1","headline":"配置讲解","description":"讲解夜莺监控的配置文件，对各个配置项的作用做详细讲解","isPartOf":{"@id":"https://n9e.github.io/zh/docs/install/configuration/"},"mainEntityOfPage":{"@id":"https://n9e.github.io/zh/docs/install/configuration/"},"datePublished":"2025-02-27T11:00:00CET","dateModified":"2025-02-27T12:20:56CET","author":{"@id":"https://n9e.github.io/#/schema/person/2"},"publisher":{"@id":"https://n9e.github.io/#/schema/organization/1"},"image":{"@id":"https://n9e.github.io/zh/docs/install/configuration/#/schema/image/2"}}]},{"@context":"https://schema.org","@graph":[{"@type":"Person","@id":"https://n9e.github.io/#/schema/person/2","name":"Henk Verlinde","sameAs":["https://twitter.com/henkverlinde","https://www.linkedin.com/in/henkverlinde/","https://github.com/UlricQin"]}]},{"@context":"https://schema.org","@graph":[{"@type":"ImageObject","@id":"https://n9e.github.io/zh/docs/install/configuration/#/schema/image/2","url":"https://n9e.github.io/doks.png","contentUrl":"https://n9e.github.io/doks.png","caption":"配置讲解"}]}]}</script><meta name=theme-color content="#fff"><link rel=apple-touch-icon sizes=180x180 href=https://n9e.github.io/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://n9e.github.io/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://n9e.github.io/favicon-16x16.png><link rel=manifest crossorigin=use-credentials href=https://n9e.github.io/site.webmanifest></head><body class="docs single"><div class=header-bar></div><header class="navbar navbar-expand-md navbar-light doks-navbar"><nav class="container-xxl flex-wrap flex-md-nowrap" aria-label="Main navigation"><a class="navbar-brand p-0 me-auto" href=/zh/ aria-label=Home>Home</a>
<button class="btn btn-menu d-block d-md-none order-5" type=button data-bs-toggle=offcanvas data-bs-target=#offcanvasDoks aria-controls=offcanvasDoks aria-label="Open main menu"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button><div class="offcanvas offcanvas-end border-0 py-md-1" tabindex=-1 id=offcanvasDoks data-bs-backdrop=true aria-labelledby=offcanvasDoksLabel><div class="header-bar d-md-none"></div><div class="offcanvas-header d-md-none"><h2 class="h5 offcanvas-title ps-2" id=offcanvasDoksLabel><a class=text-dark href=/zh/>Home</a></h2><button type=button class="btn-close text-reset me-2" data-bs-dismiss=offcanvas aria-label="Close main menu"></button></div><div class="offcanvas-body px-4"><h3 class="h6 text-uppercase mb-3 d-md-none">Main</h3><ul class="nav flex-column flex-md-row ms-md-n3"><li class=nav-item><a class="nav-link ps-0 py-1" href=https://flashcat.cloud/docs/>文档</a></li></ul><hr class="text-black-50 my-4 d-md-none"><h3 class="h6 text-uppercase mb-3 d-md-none">Socials</h3><ul class="nav flex-column flex-md-row ms-md-auto me-md-n5 pe-md-2"><li class=nav-item><a class="nav-link ps-0 py-1" href=https://github.com/ccfos/nightingale><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg><small class="ms-2 d-md-none">GitHub</small></a></li></ul></div></div><button id=mode class="btn btn-link order-md-1" type=button aria-label="Toggle user interface mode">
<span class=toggle-dark><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></span><span class=toggle-light><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></span></button><div class="dropdown order-md-2"><button class="btn btn-doks-light dropdown-toggle" id=doks-languages data-bs-toggle=dropdown aria-expanded=false data-bs-display=static>
ZH
<span class=dropdown-caret><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-down"><polyline points="6 9 12 15 18 9"/></svg></span></button><ul class="dropdown-menu dropdown-menu-end shadow rounded border-0" aria-labelledby=doks-languages><li><a class="dropdown-item current" aria-current=true href=/zh/docs/install/configuration/>Chinese</a></li><li><hr class=dropdown-divider></li><li><a class=dropdown-item rel=alternate href=/zh/en hreflang=en lang=en>English</a></li></ul></div></nav></header><nav class="doks-subnavbar py-2 sticky-lg-top" aria-label="Secondary navigation"><div class="container-xxl d-flex align-items-md-center"><form class="doks-search position-relative flex-grow-1 me-auto"><input id=search class="form-control is-search" type=search placeholder="Search docs..." aria-label="Search docs..." autocomplete=off><div id=suggestions class="shadow bg-white rounded d-none"></div></form><button class="btn doks-sidebar-toggle d-lg-none ms-3 order-3 collapsed" type=button data-bs-toggle=collapse data-bs-target=#doks-docs-nav aria-controls=doks-docs-nav aria-expanded=false aria-label="Toggle documentation navigation"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="doks doks-expand" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>Expand</title><polyline points="7 13 12 18 17 13"/><polyline points="7 6 12 11 17 6"/></svg><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="doks doks-collapse" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>Collapse</title><polyline points="17 11 12 6 7 11"/><polyline points="17 18 12 13 7 18"/></svg></button></div></nav><div class=container-xxl><aside class=doks-sidebar><nav id=doks-docs-nav class="collapse d-lg-none" aria-label="Tertiary navigation"><ul class="list-unstyled collapsible-sidebar"><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-df36888424843793b8bfe4fd460c9b87 aria-expanded=false>
前言</button><div class=collapse id=section-df36888424843793b8bfe4fd460c9b87><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/prologue/introduction/>夜莺项目介绍</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-e655a410ff21cd07e7a0150491e04371 aria-expanded=true>
安装</button><div class="collapse show" id=section-e655a410ff21cd07e7a0150491e04371><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/install/compose/>Docker Compose</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/install/helm/>Helm</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/install/binary/>二进制部署</a></li><li><a class="docs-link rounded active" href=https://n9e.github.io/zh/docs/install/configuration/>配置讲解</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-15ad62fa6c036f6a916b4336fe04c118 aria-expanded=false>
采集器</button><div class=collapse id=section-15ad62fa6c036f6a916b4336fe04c118><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/agent/intro/>前置说明</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/agent/categraf/>Categraf</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/agent/telegraf/>Telegraf</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/agent/datadog-agent/>Datadog-Agent</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-32b9362149d032ed724daac36671f31a aria-expanded=false>
使用手册</button><div class=collapse id=section-32b9362149d032ed724daac36671f31a><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/usage/datasource/>配置数据源</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/usage/ad-hoc/>Ad-hoc 查询</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/usage/alert-rules/>配置告警规则</a></li></ul></div></li></ul></nav></aside></div><div class="wrap container-xxl" role=document><div class=content><div class="row flex-xl-nowrap"><div class="col-lg-5 col-xl-4 docs-sidebar d-none d-lg-block"><nav class=docs-links aria-label="Main navigation"><ul class="list-unstyled collapsible-sidebar"><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-df36888424843793b8bfe4fd460c9b87 aria-expanded=false>
前言</button><div class=collapse id=section-df36888424843793b8bfe4fd460c9b87><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/prologue/introduction/>夜莺项目介绍</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-e655a410ff21cd07e7a0150491e04371 aria-expanded=true>
安装</button><div class="collapse show" id=section-e655a410ff21cd07e7a0150491e04371><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/install/compose/>Docker Compose</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/install/helm/>Helm</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/install/binary/>二进制部署</a></li><li><a class="docs-link rounded active" href=https://n9e.github.io/zh/docs/install/configuration/>配置讲解</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-15ad62fa6c036f6a916b4336fe04c118 aria-expanded=false>
采集器</button><div class=collapse id=section-15ad62fa6c036f6a916b4336fe04c118><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/agent/intro/>前置说明</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/agent/categraf/>Categraf</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/agent/telegraf/>Telegraf</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/agent/datadog-agent/>Datadog-Agent</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-32b9362149d032ed724daac36671f31a aria-expanded=false>
使用手册</button><div class=collapse id=section-32b9362149d032ed724daac36671f31a><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/usage/datasource/>配置数据源</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/usage/ad-hoc/>Ad-hoc 查询</a></li><li><a class="docs-link rounded" href=https://n9e.github.io/zh/docs/usage/alert-rules/>配置告警规则</a></li></ul></div></li></ul></nav></div><nav class="docs-toc d-none d-xl-block col-xl-3" aria-label="Secondary navigation"><div class=page-links><h3>On this page</h3><nav id=TableOfContents><ul><li><a href=#global>Global</a></li><li><a href=#log>Log</a></li><li><a href=#http>HTTP</a><ul><li><a href=#httpshowcaptcha>HTTP.ShowCaptcha</a></li><li><a href=#httpapiforagent>HTTP.APIForAgent</a></li><li><a href=#httpapiforservice>HTTP.APIForService</a></li><li><a href=#httpjwtauth>HTTP.JWTAuth</a></li><li><a href=#httpproxyauth>HTTP.ProxyAuth</a></li><li><a href=#httprsa>HTTP.RSA</a></li></ul></li><li><a href=#db>DB</a></li><li><a href=#redis>Redis</a></li><li><a href=#alert>Alert</a><ul><li><a href=#alertheartbeat>Alert.Heartbeat</a></li></ul></li><li><a href=#center>Center</a></li><li><a href=#pushgw>Pushgw</a><ul><li><a href=#pushgwdebugsample>Pushgw.DebugSample</a></li><li><a href=#pushgwwriteropt>Pushgw.WriterOpt</a></li><li><a href=#pushgwwriters>Pushgw.Writers</a></li></ul></li><li><a href=#ibex>Ibex</a></li><li><a href=#n9e-edge-的配置>n9e-edge 的配置</a></li></ul></nav></div></nav><main class="docs-content col-lg-11 col-xl-9"><h1>配置讲解</h1><p class=lead></p><nav class=d-xl-none aria-label="Quaternary navigation"><div class=page-links><h3>On this page</h3><nav id=TableOfContents><ul><li><a href=#global>Global</a></li><li><a href=#log>Log</a></li><li><a href=#http>HTTP</a><ul><li><a href=#httpshowcaptcha>HTTP.ShowCaptcha</a></li><li><a href=#httpapiforagent>HTTP.APIForAgent</a></li><li><a href=#httpapiforservice>HTTP.APIForService</a></li><li><a href=#httpjwtauth>HTTP.JWTAuth</a></li><li><a href=#httpproxyauth>HTTP.ProxyAuth</a></li><li><a href=#httprsa>HTTP.RSA</a></li></ul></li><li><a href=#db>DB</a></li><li><a href=#redis>Redis</a></li><li><a href=#alert>Alert</a><ul><li><a href=#alertheartbeat>Alert.Heartbeat</a></li></ul></li><li><a href=#center>Center</a></li><li><a href=#pushgw>Pushgw</a><ul><li><a href=#pushgwdebugsample>Pushgw.DebugSample</a></li><li><a href=#pushgwwriteropt>Pushgw.WriterOpt</a></li><li><a href=#pushgwwriters>Pushgw.Writers</a></li></ul></li><li><a href=#ibex>Ibex</a></li><li><a href=#n9e-edge-的配置>n9e-edge 的配置</a></li></ul></nav></div></nav><p>中心端 n9e 的配置文件是 <code>etc/config.toml</code>，边缘告警引擎 n9e-edge 的配置文件是 <code>etc/edge/edge.toml</code>。这里我们先分块讲解 n9e 的配置文件。</p><h2 id=global>Global <a href=#global class=anchor aria-hidden=true>#</a></h2><pre><code class=language-toml>[Global]
RunMode = &quot;release&quot;
</code></pre><p>这是夜莺研发人员用的配置项，普通用户不需要关心，永远保持 <code>release</code> 即可。</p><h2 id=log>Log <a href=#log class=anchor aria-hidden=true>#</a></h2><pre><code class=language-toml>[Log]
# stdout, stderr, file
Output = &quot;stdout&quot;
# log write dir
Dir = &quot;logs&quot;
# log level: DEBUG INFO WARNING ERROR
Level = &quot;DEBUG&quot;
# # rotate by time
# KeepHours = 4
# # rotate by size
# RotateNum = 3
# # unit: MB
# RotateSize = 256
</code></pre><ul><li><code>Output</code>：日志输出方式，支持 <code>stdout</code>、<code>stderr</code>、<code>file</code>，只有在 <code>file</code> 模式下才会把日志输出到文件，才会用到下面的其他配置项</li><li><code>Dir</code>：日志文件的存放目录</li><li><code>Level</code>：日志级别，支持 <code>DEBUG</code>、<code>INFO</code>、<code>WARNING</code>、<code>ERROR</code></li><li><code>KeepHours</code>：日志文件保留时间，单位小时。日志既可以按照时间切分，也可以按照大小切分，如果按照时间切分，就用这个配置项，每小时一个日志文件，如果按照大小切分，就用下面两个配置项</li><li><code>RotateNum</code>：日志文件保留数量</li><li><code>RotateSize</code>：日志文件大小，单位 MB</li></ul><h2 id=http>HTTP <a href=#http class=anchor aria-hidden=true>#</a></h2><pre><code class=language-toml>[HTTP]
# http listening address
Host = &quot;0.0.0.0&quot;
# http listening port
Port = 17000
# https cert file path
CertFile = &quot;&quot;
# https key file path
KeyFile = &quot;&quot;
# whether print access log
PrintAccessLog = false
# whether enable pprof
PProf = true
# expose prometheus /metrics?
ExposeMetrics = true
# http graceful shutdown timeout, unit: s
ShutdownTimeout = 30
# max content length: 64M
MaxContentLength = 67108864
# http server read timeout, unit: s
ReadTimeout = 20
# http server write timeout, unit: s
WriteTimeout = 40
# http server idle timeout, unit: s
IdleTimeout = 120
</code></pre><ul><li><code>Host</code>：HTTP 服务监听地址，一般都是 <code>0.0.0.0</code>，表示监听所有网卡</li><li><code>Port</code>：HTTP 服务监听端口</li><li><code>CertFile</code>：HTTPS cert 文件路径</li><li><code>KeyFile</code>：HTTPS key 文件路径</li><li><code>PrintAccessLog</code>：是否打印访问日志</li><li><code>PProf</code>：是否开启 pprof，如果开启的话，在 <code>/api/debug/pprof/</code> 下可以看到 pprof 的信息</li><li><code>ExposeMetrics</code>：是否暴露 Prometheus 的 <code>/metrics</code> 接口，用于暴露夜莺自身的监控指标</li><li><code>ShutdownTimeout</code>：HTTP 服务优雅关闭超时时间，单位秒</li><li><code>MaxContentLength</code>：HTTP 请求最大长度，单位字节</li><li><code>ReadTimeout</code>：HTTP 读超时时间，单位秒</li><li><code>WriteTimeout</code>：HTTP 写超时时间，单位秒</li><li><code>IdleTimeout</code>：HTTP 空闲超时时间，单位秒</li></ul><h3 id=httpshowcaptcha>HTTP.ShowCaptcha <a href=#httpshowcaptcha class=anchor aria-hidden=true>#</a></h3><pre><code class=language-toml>[HTTP.ShowCaptcha]
Enable = false
</code></pre><ul><li><code>Enable</code>：是否开启验证码功能</li></ul><h3 id=httpapiforagent>HTTP.APIForAgent <a href=#httpapiforagent class=anchor aria-hidden=true>#</a></h3><pre><code class=language-toml>[HTTP.APIForAgent]
Enable = true
# [HTTP.APIForAgent.BasicAuth]
# user001 = &quot;ccc26da7b9aba533cbb263a36c07dcc5&quot;
</code></pre><ul><li><code>Enable</code>：是否开启 Agent 的 API 接口，正常来讲必然是要开启的，所以这个配置项一般都是 <code>true</code></li><li><code>BasicAuth</code>：Agent 的 API 接口支持 BasicAuth，这里配置 BasicAuth 用户名和密码，一般内网通信的话，不需要配置 BasicAuth，如果是公网通信的话，建议配置 BasicAuth，而且，密码一定不要使用默认的，容易被攻击</li></ul><h3 id=httpapiforservice>HTTP.APIForService <a href=#httpapiforservice class=anchor aria-hidden=true>#</a></h3><pre><code class=language-toml>[HTTP.APIForService]
Enable = false
[HTTP.APIForService.BasicAuth]
user001 = &quot;ccc26da7b9aba533cbb263a36c07dcc5&quot;
</code></pre><ul><li><code>Enable</code>：是否开启 Service 的 API 接口，边缘告警引擎 n9e-edge 和中心 n9e 通信就依赖中心端的这部分接口，所以如果你用到了 n9e-edge，就需要启用，即设置为 <code>true</code></li><li><code>BasicAuth</code>：Service 的 API 接口支持 BasicAuth，这里配置 BasicAuth 用户名和密码，一般内网通信的话，不需要配置 BasicAuth，如果是公网通信的话，建议配置 BasicAuth，而且，密码一定一定不要使用默认的，容易被攻击</li></ul><h3 id=httpjwtauth>HTTP.JWTAuth <a href=#httpjwtauth class=anchor aria-hidden=true>#</a></h3><pre><code class=language-toml>[HTTP.JWTAuth]
# unit: min
AccessExpired = 1500
# unit: min
RefreshExpired = 10080
RedisKeyPrefix = &quot;/jwt/&quot;
</code></pre><p>夜莺的认证使用 jwt 的方式，这里配置 jwt 的过期时间，单位分钟，<code>AccessExpired</code> 是 access token 的过期时间，<code>RefreshExpired</code> 是 refresh token 的过期时间。jwt 机制下这俩 token 的作用可以问一下 GPT，这里不再赘述。夜莺会把部分 jwt 相关的信息存到 redis 中，<code>RedisKeyPrefix</code> 是 redis 的 key 前缀，一般不用改。</p><h3 id=httpproxyauth>HTTP.ProxyAuth <a href=#httpproxyauth class=anchor aria-hidden=true>#</a></h3><pre><code class=language-toml>[HTTP.ProxyAuth]
# if proxy auth enabled, jwt auth is disabled
Enable = false
# username key in http proxy header
HeaderUserNameKey = &quot;X-User-Name&quot;
DefaultRoles = [&quot;Standard&quot;]
</code></pre><p>如果你想把夜莺嵌入到你自己的系统中，可以考虑使用 ProxyAuth 方式，类似 Grafana 的 ProxyAuth。相当于用户在你自己的系统中登录，你可以拿到用户名，然后把用户名放到 <code>X-User-Name</code> 这个 Header 中传给夜莺，夜莺就会认为这个用户已经登录了。<code>DefaultRoles</code> 是默认角色，如果你不传角色，夜莺就会把这个用户当做 <code>Standard</code> 角色处理。</p><p>实际上据我观察，目前并没有社区用户使用这个功能，所以请慎重使用。</p><h3 id=httprsa>HTTP.RSA <a href=#httprsa class=anchor aria-hidden=true>#</a></h3><pre><code class=language-toml>[HTTP.RSA]
OpenRSA = false
</code></pre><p>夜莺在登录的时候，用户密码的传说是明文的，如果夜莺站点是 HTTPS 的倒是还好，如果是 HTTP 的，就建议开启 RSA 加密，这样用户密码就不会明文传输了。</p><h2 id=db>DB <a href=#db class=anchor aria-hidden=true>#</a></h2><pre><code class=language-toml>[DB]
# mysql postgres sqlite
DBType = &quot;sqlite&quot;
# postgres: host=%s port=%s user=%s dbname=%s password=%s sslmode=%s
# postgres: DSN=&quot;host=127.0.0.1 port=5432 user=root dbname=n9e_v6 password=1234 sslmode=disable&quot;
# mysql: DSN=&quot;root:1234@tcp(localhost:3306)/n9e_v6?charset=utf8mb4&amp;parseTime=True&amp;loc=Local&quot;
DSN = &quot;n9e.db&quot;
# enable debug mode or not
Debug = false
# unit: s
MaxLifetime = 7200
# max open connections
MaxOpenConns = 32
# max idle connections
MaxIdleConns = 8
</code></pre><p>DBType 和 DSN 是最为关键的，两个配置联动。DBType 支持 <code>mysql</code>、<code>postgres</code>、<code>sqlite</code> 三种数据库，DSN 是数据库连接信息，如果是 sqlite，就是数据库文件路径，如果是 mysql 或 postgres，就是数据库连接信息。</p><p>夜莺从 v8 版本开始，默认 DBType 设置的是 <code>sqlite</code>，这样方便用户快速体验，不需要安装数据库。但是，生产环境中，还请使用 <code>mysql</code> 或 <code>postgres</code>。</p><p>Postgres 和 MySQL 的 DSN 配置可以参考注释中的例子。其他配置是数据库连接相关的配置，根据自己的环境来修改即可。一般中小型环境，<code>MaxOpenConns</code> 设置为 32，<code>MaxIdleConns</code> 设置为 8 就可以了。</p><h2 id=redis>Redis <a href=#redis class=anchor aria-hidden=true>#</a></h2><pre><code class=language-toml>[Redis]
# standalone cluster sentinel miniredis
RedisType = &quot;miniredis&quot;
# address, ip:port or ip1:port,ip2:port for cluster and sentinel(SentinelAddrs)
Address = &quot;127.0.0.1:6379&quot;
# Username = &quot;&quot;
# Password = &quot;&quot;
# DB = 0
# UseTLS = false
# TLSMinVersion = &quot;1.2&quot;
# Mastername for sentinel type
# MasterName = &quot;mymaster&quot;
# SentinelUsername = &quot;&quot;
# SentinelPassword = &quot;&quot;
</code></pre><p>Redis 除了用于存储 jwt 相关的登录认证信息，还用于存放机器的心跳上报的 metadata。夜莺中支持的机器失联告警规则，就是根据 Redis 中机器的心跳时间来判断的，如果很长时间没有心跳了，就认为机器失联了。</p><p>RedisType 支持 <code>standalone</code>、<code>cluster</code>、<code>sentinel</code>、<code>miniredis</code> 四种，从夜莺 v8 版本开始，夜莺默认使用 <code>miniredis</code>，这样方便用户快速体验，不需要安装 Redis。但是，生产环境中，还请使用其他模式。</p><p>Address 是 Redis 的连接地址，根据 RedisType 的不同，配置方式也不同：</p><ul><li><code>standalone</code>：RedisType 是 <code>standalone</code> 时，Address 就是 Redis 实例的地址，格式是 <code>ip:port</code></li><li><code>cluster</code>：RedisType 是 <code>cluster</code> 时，Address 就是 Redis 集群的地址，格式是 <code>ip1:port,ip2:port</code></li><li><code>sentinel</code>：RedisType 是 <code>sentinel</code> 时，Address 就是 Redis Sentinel 的地址，格式是 <code>ip1:port,ip2:port</code>，哨兵模式下，还需要配置 <code>MasterName</code>、<code>SentinelUsername</code>、<code>SentinelPassword</code></li><li><code>UseTLS</code>：是否使用 TLS</li><li><code>TLSMinVersion</code>：TLS 最小版本，只有在 <code>UseTLS</code> 为 <code>true</code> 时才生效</li></ul><h2 id=alert>Alert <a href=#alert class=anchor aria-hidden=true>#</a></h2><p>夜莺从某个版本开始，为了降低部署复杂度，把 webapi 和告警引擎模块合并在一起了，Alert 这里的配置项是告警引擎的配置项。</p><h3 id=alertheartbeat>Alert.Heartbeat <a href=#alertheartbeat class=anchor aria-hidden=true>#</a></h3><pre><code class=language-toml>[Alert.Heartbeat]
# auto detect if blank
IP = &quot;&quot;
# unit ms
Interval = 1000
EngineName = &quot;default&quot;
</code></pre><ul><li><code>IP</code>：告警引擎的 IP 地址，如果是空的话，夜莺会自动探测。每个告警引擎都会写心跳信息到 MySQL，这样一来，每个告警引擎都知道所有活着的告警引擎列表，进而就可以做告警规则的分片处理了。比如有 100 条告警规则，有两个 n9e 组成集群，那么每个 n9e 大概会处理 50 条告警规则，当其中一个告警引擎挂掉的时候，另一个告警引擎就会接管这 100 条告警规则。</li><li><code>Interval</code>：心跳间隔，单位毫秒</li><li><code>EngineName</code>：告警引擎的名字，一般中心端就维持 <code>default</code> 即可，边缘告警引擎 n9e-edge 的话，可以自定义 EngineName，比如 <code>edge1</code>、<code>edge2</code> 等。相同 EngineName 的告警引擎会被认为是一个集群。</li></ul><h2 id=center>Center <a href=#center class=anchor aria-hidden=true>#</a></h2><p>中心端 n9e 的特有配置，边缘告警引擎 n9e-edge 没有这些配置项。即老版本的 n9e-webapi 相关的特有的配置。</p><pre><code class=language-toml>[Center]
MetricsYamlFile = &quot;./etc/metrics.yaml&quot;
I18NHeaderKey = &quot;X-Language&quot;

[Center.AnonymousAccess]
PromQuerier = true
AlertDetail = true
</code></pre><ul><li><code>MetricsYamlFile</code>：指标配置文件路径，你在快捷视图里看到的指标的解释说明就是来自这个配置文件。后来上线了指标视图，这个配置文件就不那么重要了，甚至后面计划下掉快捷视图的功能。</li><li><code>I18NHeader</code>：这是一个研发人员用的配置项，普通用户不需要关心。</li><li><code>Center.AnonymousAccess</code>：匿名访问相关的配置项。PromQuerier 是指是否允许匿名查询各数据源的接口，AlertDetail 是指是否允许匿名查看告警详情。内网环境可以开启，公网环境一定要关闭。</li></ul><p>仪表盘有个公开访问的功能，甚至可以设置为不需要登录就可以访问，但是这个前提是 PromQuerier 需要设置为 <code>true</code>，即如果 <code>PromQuerier = false</code>，那么即使设置了仪表盘为公开访问，也是需要登录的。</p><h2 id=pushgw>Pushgw <a href=#pushgw class=anchor aria-hidden=true>#</a></h2><p>夜莺虽然不直接存储监控数据，但是提供了多种接收监控数据的接口，比如 Prometheus remote write 协议的接口、OpenTSDB 协议的接口等。接收到数据之后，夜莺会把监控数据转发给后端时序库，所以这里夜莺就相当于一个 Pushgateway，跟 Pushgateway 相关的配置项就在 <code>Pushgw</code> 下面了。</p><pre><code class=language-toml>[Pushgw]
# use target labels in database instead of in series
LabelRewrite = true
ForceUseServerTS = true
</code></pre><ul><li><code>LabelRewrite</code>：夜莺有个机器管理的菜单，可以给机器打标签，并且这些标签会附加到机器相关的时序数据里。但是，如果上报的数据中有个标签和机器管理里的标签冲突了，以哪个为准呢？如果 <code>LabelRewrite</code> 为 <code>true</code>，就以机器管理里的标签为准，否则以上报的标签为准。</li><li><code>ForceUseServerTS</code>：是否强制使用服务端的时间戳，来覆盖接收到的监控数据的时间戳。之前没有这个配置项，由于很多公司的机器时间没有校准导致各种困惑，所以夜莺提供了这个配置，建议开启，统一使用服务端的时间戳得了。</li></ul><h3 id=pushgwdebugsample>Pushgw.DebugSample <a href=#pushgwdebugsample class=anchor aria-hidden=true>#</a></h3><pre><code class=language-toml>[Pushgw.DebugSample]
ident = &quot;xx&quot;
__name__ = &quot;cpu_usage_active&quot;
</code></pre><p>这个配置是为了调试、排查问题用的。这个配置其实是一个监控指标的过滤条件，如果上报给夜莺的指标符合这个过滤条件，就会打印到日志中。一般不需要配置，注释掉即可。</p><h3 id=pushgwwriteropt>Pushgw.WriterOpt <a href=#pushgwwriteropt class=anchor aria-hidden=true>#</a></h3><pre><code class=language-toml>[Pushgw.WriterOpt]
QueueMaxSize = 100000
QueuePopSize = 3000
AllQueueMaxSize = 5000000
# fresh time, unit ms
# AllQueueMaxSizeInterval = 200
</code></pre><p>这是一些流控配置，夜莺会在内存里创建很多队列，用于缓存接收到的监控数据，然后再批量写入到后端时序库。通常是每个机器一个队列，所以队列的数量就是机器的数量。</p><ul><li><code>QueueMaxSize</code>：单个队列的最大长度。</li><li><code>QueuePopSize</code>：单次从队列里取出的指标量，即每个请求写入到后端时序库的指标量。</li><li><code>AllQueueMaxSize</code>：所有队列总长度限制，如果超出这个长度，说明队列堆积，就会拒绝接收监控数据。</li><li><code>AllQueueMaxSizeInterval</code>：队列堆积检测的时间间隔，单位毫秒。维持默认即可。</li></ul><p>如果有些监控数据没有带上 agent_hostname 标签（即后来服务端 rename 之后的 ident 标签），那就没法归到某个机器队列了。这种情况下，夜莺会把数据归到指标名字对应的队列里。但是指标的数量很多，这样会在内存里建立太多队列，有两个解法：</p><ul><li>当前解法：取指标名字的前两个字符，作为队列的标识，这样就会把相同前两个字符的指标归到同一个队列里，这样队列数量就会减少很多。</li><li>未来解法：会提前创建固定数量（可配）的队列，然后把指标名字的 hash 值对队列数量取模，计算对应关系。预计会从 v8.0.0-beta7 版本开始改成这种方式。</li></ul><h3 id=pushgwwriters>Pushgw.Writers <a href=#pushgwwriters class=anchor aria-hidden=true>#</a></h3><p>这里是配置后端时序库的 remote write 写入地址，所有支持 remote write 协议的时序库都可以配置在这里。一般来讲，只需要配置一个即可，如果你想同时写入多个时序库，可以配置多个。</p><pre><code class=language-toml>[[Pushgw.Writers]]
Url = &quot;http://127.0.0.1:9090/api/v1/write&quot;
BasicAuthUser = &quot;xx&quot;
BasicAuthPass = &quot;xx&quot;

[[Pushgw.Writers]]
Url = &quot;http://127.0.0.1:8482/api/v1/write&quot;
BasicAuthUser = &quot;xx&quot;
BasicAuthPass = &quot;xx&quot;
</code></pre><ul><li><code>Url</code>：时序库的 remote write 写入地址</li><li><code>BasicAuth</code>：如果时序库需要 BasicAuth 认证，可以配置 BasicAuth 的用户名和密码</li><li><code>Headers</code>：如果时序库需要额外的 Header，可以配置在这里</li><li><code>Timeout</code>：写入超时时间，单位是毫秒</li><li><code>DialTimeout</code>：连接超时时间，单位是毫秒</li></ul><h4 id=pushgwwriterswriterelabels>Pushgw.Writers.WriteRelabels <a href=#pushgwwriterswriterelabels class=anchor aria-hidden=true>#</a></h4><p>写往时序库的数据，在写入之前可以做 relabel 的操作，这个配置项就是 relabel 的配置项。和 Prometheus 的 relabel 配置项类似，只不过 Prometheus 用的 yaml 格式，夜莺用的 toml 格式。</p><h2 id=ibex>Ibex <a href=#ibex class=anchor aria-hidden=true>#</a></h2><p>故障自愈引擎 Ibex 的配置项。即远程执行脚本的那个功能。原本这个功能是单独拆开的一个模块叫 ibex，后来合并到 n9e 里了，所以这个配置项也在 n9e 里。</p><pre><code class=language-toml>[Ibex]
Enable = true
RPCListen = &quot;0.0.0.0:20090&quot;
</code></pre><ul><li><code>Enable</code>：是否开启 Ibex 功能</li><li><code>RPCListen</code>：Ibex 的 RPC 服务监听地址</li></ul><h2 id=n9e-edge-的配置>n9e-edge 的配置 <a href=#n9e-edge-%e7%9a%84%e9%85%8d%e7%bd%ae class=anchor aria-hidden=true>#</a></h2><p>边缘告警引擎 n9e-edge 的配置文件是 <code>etc/edge/edge.toml</code>，大部分配置和中心 n9e 的配置相同。更多信息可以参考这篇文章：《<a href=https://flashcat.cloud/blog/n9e-edge-intro/>夜莺监控 - 边缘告警引擎架构详解</a>》。</p><div class="page-footer-meta d-flex flex-column flex-md-row justify-content-between"><div class=edit-page><a href=https://github.com/n9e/n9e.github.io/blob/master/content/zh/docs/install/configuration.md><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-edit-2"><path d="M17 3a2.828 2.828.0 114 4L7.5 20.5 2 22l1.5-5.5L17 3z"/></svg>Edit this page on GitHub</a></div></div><div class="docs-navigation d-flex justify-content-between"><a href=/zh/docs/install/binary/><div class="card my-1"><div class="card-body py-2">&larr; 二进制部署</div></div></a><a class=ms-auto href=/zh/docs/agent/categraf/><div class="card my-1"><div class="card-body py-2">Categraf &rarr;</div></div></a></div></main></div></div></div><footer class="footer text-muted"><div class=container-xxl><div class=row><div class="col-lg-8 order-last order-lg-first"><ul class=list-inline><li class=list-inline-item>&copy; 2025 CCF·Nightingale, all rights reserved.</li></ul></div><div class="col-lg-8 order-first order-lg-last text-lg-end"><ul class=list-inline></ul></div></div></div></footer><script src=/js/bootstrap.min.0a0106334435d4110713bfaff4acaf02533b0c56d44412a74e9518db07672ddb7e099a9c7517bc9cb529e2ddd4ae2e438b40b720288900d5e74fb6d8928d9097.js integrity="sha512-CgEGM0Q11BEHE7+v9KyvAlM7DFbURBKnTpUY2wdnLdt+CZqcdRe8nLUp4t3Uri5Di0C3ICiJANXnT7bYko2Qlw==" crossorigin=anonymous defer></script>
<script src=/js/highlight.min.0d31f7af12feb83ee633b6351b023ee643ea3412376fbaa09c5a26d1a5ef999939f1ad379a5b12e1199a2c7d72ae1b23f633060a679628dcbfb0e72378cd20be.js integrity="sha512-DTH3rxL+uD7mM7Y1GwI+5kPqNBI3b7qgnFom0aXvmZk58a03mlsS4RmaLH1yrhsj9jMGCmeWKNy/sOcjeM0gvg==" crossorigin=anonymous defer></script>
<script src=/main.min.6afc4bf655f45ae3e63629ec95be8bd2e0e792084b5635a6fe70b169fa9d1491638b3a4e900ed59c2e017ca18768e5c392e110d0e1336509f49f7dc418d16eef.js integrity="sha512-avxL9lX0WuPmNinslb6L0uDnkghLVjWm/nCxafqdFJFjizpOkA7VnC4BfKGHaOXDkuEQ0OEzZQn0n33EGNFu7w==" crossorigin=anonymous defer></script>
<script src=https://n9e.github.io/index.min.817f8872b658f71dc245d9ee44f770e3f6e7d311ef23ea7ff8ebe44511f8b52f3b05ff5834400f2f967d1e4c7d8863587975cac8e693b407f3bdb3f6762ec2a5.js integrity="sha512-gX+IcrZY9x3CRdnuRPdw4/bn0xHvI+p/+OvkRRH4tS87Bf9YNEAPL5Z9Hkx9iGNYeXXKyOaTtAfzvbP2di7CpQ==" crossorigin=anonymous defer></script>
<script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?9d7cc507a7aae60b28b5e04bb995492a",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script></body></html>